{% extends 'base.html' %}

{% block content %}
<div class="container text">
    <h2 class="mt-4 mb-4">Export Tasks</h2>
    <form id="export-form" method="post" action="{% url 'tasks:export_tasks' %}">
        {% csrf_token %}
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="select-all">
                    <label class="form-check-label" for="select-all">Select All</label>
                </div>
            </div>
            <div class="btn-group">
                <button type="submit" name="format" value="pdf" class="btn btn-primary">
                    <i class="fas fa-download"></i> Export as PDF
                </button>
                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                    <span class="visually-hidden">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                    <li><button type="submit" name="format" value="svg" class="dropdown-item">SVG</button></li>
                </ul>
            </div>
        </div>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th></th>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Due Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr>
                    <td><input class="form-check-input task-checkbox" type="checkbox" name="task_ids" value="{{ task.id }}"></td>
                    <td class="text-dark">{{ task.title }}</td>
                    <td class="text-dark">{{ task.category }}</td>
                    <td class="text-dark">{{ task.due_date|date:"M d, Y" }}</td>
                    <td>
                        {% if task.is_completed %}
                            <span class="badge bg-success">Completed</span>
                        {% elif task.due_date < today and not task.is_completed %}
                            <span class="badge bg-danger">Overdue</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">Incomplete</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAll = document.getElementById('select-all');
    const taskCheckboxes = document.querySelectorAll('.task-checkbox');

    selectAll.addEventListener('change', function() {
        taskCheckboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });

    taskCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            if (!this.checked) {
                selectAll.checked = false;
            }
        });
    });
});
</script>
{% endblock %}
