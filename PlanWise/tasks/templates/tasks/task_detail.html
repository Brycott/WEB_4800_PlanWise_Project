{% extends "base.html" %} {% block title %}Task Details{% endblock %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/flatpickr.min.css' %}?v=2">

<div class="card mb-4">
  <div class="card-body">
    <h2 class="card-title">
      {% if task.completed %}
      <s>{{ task.title }}</s>
      {% else %} {{ task.title }} {% endif %}
      <span class="badge bg-{{ task.priority|lower }}-light text-{{ task.priority|lower }}"></span>
    </h2>
    <p class="card-text">{{ task.description }}</p>
    {% if task.category %}
    <span class="badge bg-secondary">
      <i class="fas fa-tag"></i> {{ task.category }}
    </span>
    {% endif %}
    <div class="mt-3">
      <small>Created: {{ task.created_at|date:"M d, Y" }}</small>
      {% if task.due_date %}
      <br />
      <small>Due: {{ task.due_date|date:"M d, Y" }}</small>
      {% endif %}
      <br />
      <small>Status: {% if task.completed %}Completed{% else %}Pending{% endif %}</small>
    </div>
  </div>
</div>

<div class="d-flex flex-column  gap-2">
  <div class="d-flex w-100 gap-2 mb-3">
  <a href="{% url 'tasks:task_update' task.pk %}" class="btn btn-secondary h-25">
    <i class="fas fa-edit"></i> Edit Task
  </a>
  <form action="{% url 'tasks:task_delete' task.pk %}" method="post"
    onsubmit="return confirm('Are you sure you want to delete this task?');">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">
      <i class="fas fa-trash-alt"></i> Delete Task
    </button>
  </form>
  <a href="{% url 'tasks:task_list' %}" class="btn btn-primary h-25">
    <i class="fas fa-arrow-left"></i> Back to Task List
  </a>
  </div>
  {% if not task.parent %}
  <hr>
  <br>

  <div>
    <h3>Subtasks</h3>

    {% for subtask in subtasks %}
    <div class="card mb-2">
      <div class="card-body">
        <a href="{{ subtask.get_absolute_url }}">{{ subtask.title }}</a>
        - {{ subtask.is_completed|yesno:"Completed,Pending" }}
      </div>
    </div>
    {% empty %}
    <p>No subtasks yet.</p>
    {% endfor %}

    <hr>
  </div>

  <h3>Add Subtask</h3>
  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Add Subtask</button>
  </form>
  {% endif %}
</div>

 <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    const fp = flatpickr('input[name="due_date"]', {
      dateFormat: 'Y-m-d',
      allowInput: true
    });
    document.getElementById('dueDateIcon')?.addEventListener('click', () => fp.open());
  </script>
  {% endblock %}